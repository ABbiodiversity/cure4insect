<!DOCTYPE html>
<html lang="en">
<head>
<title>Custom Reporting for Intactness and Sector Effects</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<script src="assets/jquery-1.11.1.min.js"></script>
<script src="assets/opencpu-0.4.min.js"></script>

<link href="assets/bootstrap.min.css" rel="stylesheet" media="screen">
<link href="assets/jquery-ui.min.css" rel="stylesheet" media="screen">
<link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" media="screen">

<script src="assets/bootstrap.min.js"></script>
<script src="assets/jquery-ui.min.js"></script>

<script>
ocpu.seturl("http://sc-dev.abmi.ca/ocpu/library/ocpuapps/R")
//ocpu.seturl("http://sc-dev.abmi.ca/ocpu/library/cure4insect/R")

$(document).ready(function () {

  $("#submitbutton").on("click", function(){

//      var myheader = $("#header").val() == "true";
      var myheader = $("#header").is(':checked');
      var myfile = $("#csvfile")[0].files[0];
      var myvar = $("#variable").val();
      var myemail = $("#inputEmail").val();

      if(!myfile){
          alert("No spatial subset file selected.");
          return;
      }
      if(!myemail){
          alert("No email specified.");
          return;
      }

      $("#submitbutton").attr("disabled", "disabled");

      var req1 = ocpu.call("readCsv", { // app_read_csv
          "file" : myfile,
          "header" : myheader
      }, function(session1){
          var req2 = ocpu.call("example1", { // custom_report
              "id1" : session1,
              "id2" : myvar,
              "att" : myemail
          }, function(session2){
              session2.getConsole(function(outtxt){
                  $("#output").text(outtxt);
              });

          });
          req2.fail(function(){
              alert("Server error: " + req2.responseText);
          });
          req2.always(function(){
              $("#submitbutton").removeAttr("disabled")
          });
      });
      req1.fail(function(){
          alert("Server error: " + req1.responseText);
      });
      // reset variables
      $("#header").val("true");
      $("#csvfile").val("");
      $("#variable").val("all");

  });

});
</script>

</head>
<body>
  <div class="container">

    <div class="row">
      <h1>Custom Reporting for Intactness and Sector Effects</h1>
      <div class="col-md-4">
        <div class="panel panel-default">
          <div class="panel-heading"><i class="fa fa-map-marker" aria-hidden="true"></i> Spatial Subsets</div>
          <div class="panel-body">
            <p>
              Upload a comma-separated text (CSV) file with spatial unit IDs in the 1st column (optionally with a header in the 1st row).
            </p>
            <p>
              <input type="file" id="csvfile">
            </p>
            <!-- <p>
              Header <select id="header">
              <option value="true">Yes</option>
              <option value="false">No</option>
              </select>
            </p> -->
           <p>
              <div class="checkbox">
                <label>
                  <input type="checkbox" id="header"> Header
                </label>
              </div>
            </p>

          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="panel panel-default">
          <div class="panel-heading"><i class="fa fa-leaf" aria-hidden="true"></i> Species Groups</div>
          <div class="panel-body">
            <p>
              Select all species or one of the taxonomic groups from the menu.
            </p>
            <p>
              <select id="variable">
              <option value="all">All species</option>
              <option value="mammals" disabled="disabled">Mammals</option>
              <option value="birds">Birds</option>
              <option value="vplants">Vascular Plants</option>
              <option value="mosses">Bryophytes</option>
              <option value="Lichens">Lichens</option>
            </select>
            </p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="panel panel-default">
          <div class="panel-heading"> <i class="fa fa-envelope" aria-hidden="true"></i> Email Address</div>
          <div class="panel-body">
            <p>
              Specify email address where the results should be sent.
            </p>
            <p>
              <form class="form-inline">
                <div class="form-group">
                  <label for="inputEmail">Email</label>
                  <input type="email" class="form-control" id="inputEmail" placeholder="you@example.com">
                </div>
              </form>
            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4 col-md-offset-4">
      <center>
        <button type="submit" id="submitbutton" class="btn btn-primary">Submit Request</button>
      </center>
      <pre><code id="output"></code></pre>
    </div>

</body>
</html>
