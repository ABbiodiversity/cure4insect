<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Custom Reporting for Intactness and Sector Effects • cure4insect</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Custom Reporting for Intactness and Sector Effects">
<meta property="og:description" content="Decision support tool
  that provides an interface to enable
  custom reporting for intactness and sector effects
  based on estimates and predictions created by the Alberta
  Biodiversity Monitoring Institute (ABMI)
  in collaboration with the Boreal Avian Modelling (BAM) Project.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">cure4insect</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/example.html">Example Species Report</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ABbiodiversity/cure4insect">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="cure4insect" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#cure4insect" class="anchor"></a>cure4insect <img src="https://raw.githubusercontent.com/ABbiodiversity/cure4insect/master/abundance.gif" align="right" style="padding-left:10px;background-color:white;">
</h1></div>
<blockquote>
<p>Custom Reporting for Intactness and Sector Effects</p>
</blockquote>
<p><a href="https://travis-ci.org/ABbiodiversity/cure4insect"><img src="https://travis-ci.org/ABbiodiversity/cure4insect.svg?branch=master" alt="Linux build status"></a></p>
<p>The <a href="https://www.r-project.org/">R</a> package is a decision support tool that provides an interface to enable custom reporting for intactness and sector effects based on estimates and predictions created by the <a href="http://abmi.ca/">Alberta Biodiversity Monitoring Institute (ABMI)</a> in collaboration with the <a href="http://www.borealbirds.ca/">Boreal Avian Modelling (BAM) Project</a>.</p>
<ul>
<li><a href="https://abbiodiversity.github.io/cure4insect/intro/">Few slides about the motivations</a></li>
<li><a href="https://abbiodiversity.github.io/cure4insect/example/">Example species report</a></li>
<li><a href="https://abbiodiversity.github.io/cure4insect/site/">Custom report</a></li>
<li><a href="http://sc-dev.abmi.ca/ocpu/apps/ABbiodiversity/cure4insect/www/">Web app</a></li>
</ul>
<div id="license" class="section level2">
<h2 class="hasAnchor">
<a href="#license" class="anchor"></a>License</h2>
<p>The estimates, predictions, and related documentation are © ABMI and BAM (2014–2018) under a <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0 license</a>.</p>
<p>The R package itself is licensed under <a href="LICENSE.html">MIT license</a> © 2018 Peter Solymos, Brandon Allen, Ermias T. Azeria, Shannon R. White, ABMI &amp; BAM.</p>
</div>
<div id="getting-help-or-reporting-an-issue" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-help-or-reporting-an-issue" class="anchor"></a>Getting help or reporting an issue</h2>
<p>To report bugs/issues/feature requests, please file an <a href="https://github.com/ABbiodiversity/cure4insect/issues">issue</a>.</p>
</div>
<div id="how-to-contribute" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-contribute" class="anchor"></a>How to contribute</h2>
<p>If you would like to contribute to the package, please see our <a href="CONTRIBUTING.html">CONTRIBUTING</a> guidelines.</p>
<p>Please note that this project is released with a <a href="CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms.</p>
</div>
<div id="install" class="section level2">
<h2 class="hasAnchor">
<a href="#install" class="anchor"></a>Install</h2>
<p>Only GitHub version available now:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">remotes<span class="op">::</span><span class="kw"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span>(<span class="st">"ABbiodiversity/cure4insect"</span>)</a></code></pre></div>
<p>If it fails for some reason, you can try:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">drat<span class="op">::</span><span class="kw">addRepo</span>(<span class="st">"ABbiodiversity"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"cure4insect"</span>)</a></code></pre></div>
<p>The <a href="NEWS.html">NEWS</a> file lists user visible changes in the different versions.</p>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>Load the package and the common data set:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(cure4insect)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">load_common_data</a></span>()</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">## loading common data</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">##         version yr_first yr_last        method     hf  veg          model</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">## mammals    2018     2001    2013 snow_tracking 2016v3 v6.1 binomial_logit</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">## birds      2018     1997    2017   point_count 2016v3 v6.1    poisson_log</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">## mites      2018     2007    2017     soil_core 2016v3 v6.1 binomial_logit</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">## mosses     2018     2003    2016   centre_plot 2016v3 v6.1 binomial_logit</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">## lichens    2018     2003    2017   centre_plot 2016v3 v6.1 binomial_logit</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">## vplants    2018     2003    2017   centre_plot 2016v3 v6.1 binomial_logit</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">##         species</a>
<a class="sourceLine" id="cb3-12" data-line-number="12">## mammals      12</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">## birds       126</a>
<a class="sourceLine" id="cb3-14" data-line-number="14">## mites       114</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">## mosses      125</a>
<a class="sourceLine" id="cb3-16" data-line-number="16">## lichens     155</a>
<a class="sourceLine" id="cb3-17" data-line-number="17">## vplants     442</a></code></pre></div>
<p>Note: it is possible to download the data the package is using to your hard drive using the <code>dowload_data</code> function.</p>
<div id="workflow-with-1-species" class="section level4">
<h4 class="hasAnchor">
<a href="#workflow-with-1-species" class="anchor"></a>Workflow with 1 species</h4>
<p><code>id</code> is a vector of <code>Row_Col</code> type IDs of 1 km<sup>2</sup> pixels, <code>species</code> is a vector of species IDs:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">## define spatial and species IDs (subsets)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">Spp &lt;-<span class="st"> "Ovenbird"</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">ID &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"182_362"</span>, <span class="st">"182_363"</span>, <span class="st">"182_364"</span>, <span class="st">"182_365"</span>, <span class="st">"182_366"</span>, <span class="st">"182_367"</span>,</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">    <span class="st">"182_368"</span>, <span class="st">"182_369"</span>, <span class="st">"182_370"</span>, <span class="st">"182_371"</span>, <span class="st">"182_372"</span>)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">subset_common_data</a></span>(<span class="dt">id=</span>ID, <span class="dt">species=</span>Spp)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">## check subsets</a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_subset_id</a></span>())</a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_subset_species</a></span>())</a>
<a class="sourceLine" id="cb4-10" data-line-number="10"></a>
<a class="sourceLine" id="cb4-11" data-line-number="11">## load species data</a>
<a class="sourceLine" id="cb4-12" data-line-number="12">y &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">load_species_data</a></span>(Spp)</a>
<a class="sourceLine" id="cb4-13" data-line-number="13"></a>
<a class="sourceLine" id="cb4-14" data-line-number="14">## calculate results and flatten to a 1-liner</a>
<a class="sourceLine" id="cb4-15" data-line-number="15">x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">calculate_results</a></span>(y)</a>
<a class="sourceLine" id="cb4-16" data-line-number="16">x</a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">flatten</a></span>(x)</a></code></pre></div>
</div>
<div id="spatial-subset-specifications" class="section level4">
<h4 class="hasAnchor">
<a href="#spatial-subset-specifications" class="anchor"></a>Spatial subset specifications</h4>
<p>All the possible spatial IDs can be inspected as:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_all_id</a></span>())</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(xy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_id_locations</a></span>(), <span class="dt">pch=</span><span class="st">"."</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(xy)</a></code></pre></div>
<p>Spatial IDs can be specified as planning/management regions:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">## Natural Regions</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">ID &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_all_id</a></span>(<span class="dt">nr=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Boreal"</span>, <span class="st">"Foothills"</span>))</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">## Natural Subregions</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">ID &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_all_id</a></span>(<span class="dt">nsr=</span><span class="st">"Lower Boreal Highlands"</span>)</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">## Land Use Framework regions</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">ID &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_all_id</a></span>(<span class="dt">luf=</span><span class="st">"North Saskatchewan"</span>)</a></code></pre></div>
<p>Alternatively, <code>id</code> can refer to quarter sections using the <code>MER-RGE-TWP-SEC-QS</code> format:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">Spp &lt;-<span class="st"> "Ovenbird"</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">QSID &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"4-12-1-2-SE"</span>, <span class="st">"4-12-1-2-SW"</span>, <span class="st">"4-12-1-3-SE"</span>, <span class="st">"4-12-1-3-SW"</span>)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">qs2km</a></span>(QSID) <span class="co"># corresponding Row_Col IDs</span></a></code></pre></div>
<p>The <code>subset_common_data</code> function recognizes <code>MER-RGE-TWP-SEC-QS</code> type spatial IDs and onvert those to the <code>Row_Col</code> format using the nearest 1 km<sup>2</sup> pixels.</p>
</div>
<div id="workflow-with-multiple-species" class="section level4">
<h4 class="hasAnchor">
<a href="#workflow-with-multiple-species" class="anchor"></a>Workflow with multiple species</h4>
<p><code>id</code> and <code>species</code> can be defined using text files:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">load_common_data</a></span>()</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">Spp &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/species.txt"</span>, <span class="dt">package=</span><span class="st">"cure4insect"</span>))</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(Spp)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">ID &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/pixels.txt"</span>, <span class="dt">package=</span><span class="st">"cure4insect"</span>))</a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(ID)</a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">subset_common_data</a></span>(<span class="dt">id=</span>ID, <span class="dt">species=</span>Spp)</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">xx &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">report_all</a></span>()</a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(xx)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(rbind, <span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(xx, flatten))</a></code></pre></div>
</div>
<div id="species-subset-specifications" class="section level4">
<h4 class="hasAnchor">
<a href="#species-subset-specifications" class="anchor"></a>Species subset specifications</h4>
<p>Here is how to inspect all possible species IDs</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_all_species</a></span>())</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_species_table</a></span>())</a></code></pre></div>
<p>Select one or more taxonomic groups (mammals, birds, mites, mosses, lichens, vpalnst), and fiter for habitat and status:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">## birds and mammals</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_all_species</a></span>(<span class="dt">taxon=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"birds"</span>, <span class="st">"mammals"</span>)))</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">## all upland species</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_all_species</a></span>(<span class="dt">taxon=</span><span class="st">"all"</span>, <span class="dt">habitat=</span><span class="st">"upland"</span>))</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">## nonnative vascular plants</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_all_species</a></span>(<span class="dt">taxon=</span><span class="st">"vplants"</span>, <span class="dt">status=</span><span class="st">"nonnative"</span>))</a></code></pre></div>
</div>
<div id="wrapper-functions" class="section level4">
<h4 class="hasAnchor">
<a href="#wrapper-functions" class="anchor"></a>Wrapper functions</h4>
<ul>
<li>
<code>species="all"</code> runs all species</li>
<li>
<code>species="mites"</code> runs all mite species</li>
<li>
<code>sender="you@example.org"</code> will send an email with the results attached</li>
<li>increase <code>cores</code> to allow parallel processing</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">z &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">custom_report</a></span>(<span class="dt">id=</span>ID,</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">    <span class="dt">species=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AlderFlycatcher"</span>, <span class="st">"Achillea.millefolium"</span>),</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">    <span class="dt">address=</span><span class="ot">NULL</span>, <span class="dt">cores=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">z</a></code></pre></div>
<p>Working with a local copy of the results is much faster set path via function arguments or the options:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">## making of the file raw_all.rda</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(cure4insect)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">opar &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">set_options</a></span>(<span class="dt">path =</span> <span class="st">"w:/reports"</span>)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/options.html">getOption</a></span>(<span class="st">"cure4insect"</span>)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">load_common_data</a></span>()</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">subset_common_data</a></span>(<span class="dt">id=</span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_all_id</a></span>(),</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">    <span class="dt">species=</span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_all_species</a></span>())</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">## see how these compare</a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(res &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">report_all</a></span>(<span class="dt">cores=</span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#system.time(res &lt;- report_all(cores=2))</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#system.time(res &lt;- report_all(cores=4))</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12">## this is for testing only</a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="co">#system.time(res &lt;- .report_all_by1())</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14">(<span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">set_options</a></span>(opar)) <span class="co"># reset options</span></a></code></pre></div>
<p>A few more words about options:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">## options</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/options.html">getOption</a></span>(<span class="st">"cure4insect"</span>)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">## change configs in this file to make it permanent for a given installation</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/drop.html">drop</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/dcf.html">read.dcf</a></span>(<span class="dt">file=</span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"config/defaults.conf"</span>,</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">    <span class="dt">package=</span><span class="st">"cure4insect"</span>))))</a></code></pre></div>
</div>
<div id="sector-effects-and-intactness-plots" class="section level4">
<h4 class="hasAnchor">
<a href="#sector-effects-and-intactness-plots" class="anchor"></a>Sector effects and intactness plots</h4>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">## *res*ults from calculate_results, all province, all species</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">fn &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"http://sc-dev.abmi.ca/reports/"</span>,</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">    <span class="kw"><a href="https://rdrr.io/r/base/options.html">getOption</a></span>(<span class="st">"cure4insect"</span>)<span class="op">$</span>version, <span class="st">"/misc/raw_all.rda"</span>)</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">con &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/connections.html">url</a></span>(fn)</a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/base/load.html">load</a></span>(con)</a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/r/base/connections.html">close</a></span>(con)</a>
<a class="sourceLine" id="cb14-7" data-line-number="7"></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/plots.html">plot_sector</a></span>(res[[<span class="st">"CanadaWarbler"</span>]], <span class="st">"unit"</span>)</a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/plots.html">plot_sector</a></span>(res[[<span class="st">"CanadaWarbler"</span>]], <span class="st">"regional"</span>)</a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/plots.html">plot_sector</a></span>(res[[<span class="st">"CanadaWarbler"</span>]], <span class="st">"underhf"</span>)</a>
<a class="sourceLine" id="cb14-11" data-line-number="11"></a>
<a class="sourceLine" id="cb14-12" data-line-number="12">z &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(rbind, <span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(res, flatten))</a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(z) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"c4idf"</span>, <span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(z))</a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/plots.html">plot_sector</a></span>(z, <span class="st">"unit"</span>) <span class="co"># all species</span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/plots.html">plot_sector</a></span>(z[<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>,], <span class="st">"regional"</span>) <span class="co"># use a subset</span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/plots.html">plot_sector</a></span>(z, <span class="st">"underhf"</span>, <span class="dt">method=</span><span class="st">"hist"</span>) <span class="co"># binned version</span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"></a>
<a class="sourceLine" id="cb14-18" data-line-number="18"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/plots.html">plot_intactness</a></span>(z, <span class="st">"SI"</span>)</a>
<a class="sourceLine" id="cb14-19" data-line-number="19"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/plots.html">plot_intactness</a></span>(z, <span class="st">"SI2"</span>, <span class="dt">method=</span><span class="st">"hist"</span>)</a></code></pre></div>
</div>
<div id="determining-spatial-ids-based-on-spatial-polygons" class="section level4">
<h4 class="hasAnchor">
<a href="#determining-spatial-ids-based-on-spatial-polygons" class="anchor"></a>Determining spatial IDs based on spatial polygons</h4>
<p><code>id</code> can also be a SpatialPolygons object based on GeoJSON for example:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rgdal)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">dsn &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/polygon.geojson"</span>, <span class="dt">package=</span><span class="st">"cure4insect"</span>)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(dsn), <span class="dt">sep=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">ply &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/rgdal/man/readOGR.html">readOGR</a></span>(<span class="dt">dsn=</span>dsn)</a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">subset_common_data</a></span>(<span class="dt">id=</span>ply, <span class="dt">species=</span>Spp)</a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">make_subset_map</a></span>())</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">xx2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">report_all</a></span>()</a></code></pre></div>
<p>Spatial IDs of the 1 km<sup>2</sup> spatial pixel units are to be used for the custom summaries. The <code>Row_Col</code> field defines the IDs and links the raster cells to the <a href="http://sc-dev.abmi.ca/reports/2017/grids/Grid1km_working.gdb.zip">geodatabase</a> or <a href="http://sc-dev.abmi.ca/reports/2017/grids/Grid1km_working.csv.zip%7D">CSV</a> (with latitude/longitude in <a href="http://spatialreference.org/ref/epsg/3402/">NAD_1983_10TM_AEP_Forest</a> projection).</p>
<p>For the <a href="http://sc-dev.abmi.ca/ocpu/apps/ABbiodiversity/cure4insect/www/">web application</a>, use your favourite GIS software, or in R use this to get the spatial IDs written into a text file:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rgdal)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">load_common_data</a></span>()</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">dsn &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/OSA_bound.geojson"</span>, <span class="dt">package=</span><span class="st">"cure4insect"</span>)</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">ply &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/rgdal/man/readOGR.html">readOGR</a></span>(<span class="dt">dsn=</span>dsn)</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">ID &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">overlay_polygon</a></span>(ply)</a>
<a class="sourceLine" id="cb16-6" data-line-number="6">## write IDs into a text file</a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="kw"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">SpatialID=</span>ID), <span class="dt">row.names=</span><span class="ot">FALSE</span>, <span class="dt">file=</span><span class="st">"SpatialID.txt"</span>)</a>
<a class="sourceLine" id="cb16-8" data-line-number="8"></a>
<a class="sourceLine" id="cb16-9" data-line-number="9">## spatial pixels: selection in red</a>
<a class="sourceLine" id="cb16-10" data-line-number="10">xy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_id_locations</a></span>()</a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(xy, <span class="dt">col=</span><span class="st">"grey"</span>, <span class="dt">pch=</span><span class="st">"."</span>)</a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(xy[ID,], <span class="dt">col=</span><span class="st">"red"</span>, <span class="dt">pch=</span><span class="st">"."</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb16-13" data-line-number="13"></a>
<a class="sourceLine" id="cb16-14" data-line-number="14">## compare with the polygons</a>
<a class="sourceLine" id="cb16-15" data-line-number="15">AB &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/rgdal/man/readOGR.html">readOGR</a></span>(<span class="dt">dsn=</span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/AB_bound.geojson"</span>,</a>
<a class="sourceLine" id="cb16-16" data-line-number="16">    <span class="dt">package=</span><span class="st">"cure4insect"</span>))</a>
<a class="sourceLine" id="cb16-17" data-line-number="17"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(AB, <span class="dt">col=</span><span class="st">"grey"</span>)</a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(ply, <span class="dt">col=</span><span class="st">"red"</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p>Use the <code><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">make_subset_map()</a></code> function to get a raster map of the spatial selection.</p>
</div>
<div id="raster-objects-and-maps" class="section level4">
<h4 class="hasAnchor">
<a href="#raster-objects-and-maps" class="anchor"></a>Raster objects and maps</h4>
<p>The result is a raster stack object with the following layers:</p>
<ul>
<li>
<code>NC</code>, <code>NR</code>: current and reference abundance,</li>
<li>
<code>SI</code>, <code>SI2</code>: one- and two-sided intactness,</li>
<li>
<code>SE</code>, <code>CV</code>: bootstrap based standard error and coefficient of variation estimates for current abundance.</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">load_common_data</a></span>()</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">y &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">load_species_data</a></span>(<span class="st">"Ovenbird"</span>)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">r &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">rasterize_results</a></span>(y)</a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(r, <span class="st">"NC"</span>) <span class="co"># current abundance map</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5">col &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"darkgreen"</span>,<span class="st">"yellow"</span>,<span class="st">"red"</span>))(<span class="dv">250</span>)</a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(r, <span class="st">"SE"</span>, <span class="dt">col=</span>col) <span class="co"># standadr errors for current abundance</span></a></code></pre></div>
<p>It is possible to make multi-species maps as well: average intactness and expected number of species.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">subset_common_data</a></span>(<span class="dt">species=</span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_all_species</a></span>(<span class="dt">taxon=</span><span class="st">"birds"</span>))</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">r1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">make_multispecies_map</a></span>(<span class="st">"richness"</span>)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">r2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">make_multispecies_map</a></span>(<span class="st">"intactness"</span>)</a></code></pre></div>
</div>
<div id="spatially-explicit-polygon-level-predictions" class="section level4">
<h4 class="hasAnchor">
<a href="#spatially-explicit-polygon-level-predictions" class="anchor"></a>Spatially explicit (polygon level) predictions</h4>
<p>The 1 km<sup>2</sup> level predictions provide mean abundance per pixel. Sometimes we need finer detail, e.g. when making predictions as part of spatially explicit simulations.</p>
<p>First we load the spatial/climate related component of the predictions (which is a raster object):</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">load_common_data</a></span>()</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">species &lt;-<span class="st"> "Achillea.millefolium"</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3">object &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">load_spclim_data</a></span>(species)</a></code></pre></div>
<p>The spatial component is then combined with the land cover component describing vegetation/disturbance/soil classes as a factor.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">## original levels</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(veg &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_levels</a></span>()<span class="op">$</span>veg))</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(soil &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_levels</a></span>()<span class="op">$</span>soil))</a></code></pre></div>
<p>Sometimes it is best to create a crosswalk table and reclassify using e.g. the <code><a href="https://rdrr.io/pkg/mefa4/man/find_max.html">mefa4::reclass</a></code> function:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">(rc &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">In=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pine5"</span>, <span class="st">"decid15"</span>, <span class="st">"urban"</span>, <span class="st">"industrial"</span>),</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">    <span class="dt">Out=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Pine0"</span>, <span class="st">"Deciduous10"</span>, <span class="st">"UrbInd"</span>, <span class="st">"UrbInd"</span>)))</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">mefa4<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/mefa4/man/find_max.html">reclass</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pine5"</span>, <span class="st">"pine5"</span>, <span class="st">"decid15"</span>, <span class="st">"urban"</span>, <span class="st">"industrial"</span>), rc)</a></code></pre></div>
<p>We need to have spatial locations for each land cover value (same value can be repeated, but but avoid duplicate rownames). We use the <strong>sp</strong> package to make a SpatialPoints object:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">XY &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_id_locations</a></span>()</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">coords &lt;-<span class="st"> </span><span class="kw">coordinates</span>(XY)[<span class="dv">10</span><span class="op">^</span><span class="dv">5</span>,,drop=<span class="ot">FALSE</span>]</a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(coords) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4">xy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(coords[<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1</span>, <span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(veg)),])</a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="kw">coordinates</span>(xy) &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span>POINT_X <span class="op">+</span><span class="st"> </span>POINT_Y</a>
<a class="sourceLine" id="cb22-6" data-line-number="6"><span class="kw">proj4string</span>(xy) &lt;-<span class="st"> </span><span class="kw">proj4string</span>(XY)</a></code></pre></div>
<p>Now we are ready to make the predictions:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">pred &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(object, <span class="dt">xy=</span>xy, <span class="dt">veg=</span>veg)</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(pred)</a></code></pre></div>
<p>The <code>predict</code> function returns a data frame with columns <code>veg</code>, <code>soil</code>, and <code>comb</code> (combines <code>veg</code> and <code>soil</code> based on aspen probability of occurrence using <code>combine_veg_soil</code> as a weighted average based on probability of aspen occurrence).</p>
<p>For some species, either the <code>veg</code> or <code>soil</code> based estimates are unavailable: <code>predict</code> returns <code>NA</code> for these and the combined results will be <code>NA</code> as well.</p>
<p>The next line is a more succinct version that loads the species data as well, but we can’t reuse the species data after:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">pred &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">custom_predict</a></span>(species, <span class="dt">xy=</span>xy, <span class="dt">veg=</span>veg)</a></code></pre></div>
<p>Another was of making predictions is to define a spatial grid, and quantify land cover as proportion of the land cover types in each grid cell. This is how we can use multivariate input data in a spatial grid (totally unrealistic data set just for illustration, but user has to make sure the numbers are meaningful):</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">xy &lt;-<span class="st"> </span>xy[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,]</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">mveg &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">8</span>)</a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(mveg) &lt;-<span class="st"> </span>veg[<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">8</span> <span class="op">*</span><span class="st"> </span><span class="dv">10</span>)]</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">mveg[] &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span>(<span class="dv">80</span>, <span class="dv">10</span>) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="dv">80</span>, <span class="dv">1</span>, <span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb25-5" data-line-number="5">mveg[<span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(mveg)<span class="op">==</span><span class="dv">0</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co"># avoid 0 row sum</span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6">mveg</a>
<a class="sourceLine" id="cb25-7" data-line-number="7"></a>
<a class="sourceLine" id="cb25-8" data-line-number="8">msoil &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb25-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(msoil) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">get_levels</a></span>()<span class="op">$</span>soil[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]</a>
<a class="sourceLine" id="cb25-10" data-line-number="10">msoil[] &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span>(<span class="dv">60</span>, <span class="dv">10</span>) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="dv">60</span>, <span class="dv">1</span>, <span class="fl">0.4</span>)</a>
<a class="sourceLine" id="cb25-11" data-line-number="11">msoil[<span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(msoil)<span class="op">==</span><span class="dv">0</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co"># avoid 0 row sum</span></a>
<a class="sourceLine" id="cb25-12" data-line-number="12">msoil</a></code></pre></div>
<p>Because we used areas (not proportions) we get the output as two matrices containing abundances (density times area) corresdonding to the vegetation and soil matrices:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">(prmat1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">predict_mat</a></span>(object, xy, mveg, msoil))</a></code></pre></div>
<p>Row sums give the total abundance at each location, column sums give the total abundance in a land cover type over all locations:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(prmat1<span class="op">$</span>veg)</a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span>(prmat1<span class="op">$</span>veg)</a></code></pre></div>
<p>Using proportions in the input matrices gives mean abundance per spatial unit as output:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">(prmat2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">predict_mat</a></span>(object, xy, mveg<span class="op">/</span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(mveg), msoil<span class="op">/</span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(msoil)))</a></code></pre></div>
<p>Combining vegetation and soil based predictions returns a vector, i.e. the aspen probability weighted average of the vegetation and soil based total abundances:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">combine_veg_soil</a></span>(xy, <span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(prmat2<span class="op">$</span>veg), <span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(prmat2<span class="op">$</span>soil))</a></code></pre></div>
</div>
<div id="visualize-land-cover-associations" class="section level4">
<h4 class="hasAnchor">
<a href="#visualize-land-cover-associations" class="anchor"></a>Visualize land cover associations</h4>
<p>See the following <a href="http://rmarkdown.rstudio.com/">R markdown</a> file for a worked example of visualizations available in the package:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/file.show.html">file.show</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"doc/example-species-report.Rmd"</span>, <span class="dt">package=</span><span class="st">"cure4insect"</span>))</a></code></pre></div>
<p>It is possible to render the R markdown file with a species ID argument, thus programmatically producing reports for multiple species:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rmarkdown)</a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/pkg/rmarkdown/man/render.html">render</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"doc/example-species-report.Rmd"</span>,</a>
<a class="sourceLine" id="cb31-3" data-line-number="3">    <span class="dt">package=</span><span class="st">"cure4insect"</span>),</a>
<a class="sourceLine" id="cb31-4" data-line-number="4">    <span class="dt">params =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">species =</span> <span class="st">"Ovenbird"</span>))</a></code></pre></div>
<p>Habitat associations as shown on the <a href="http://sc-dev.abmi.ca/">sc-dev.abmi.ca</a> website:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/core_functions.html">load_common_data</a></span>()</a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/plots.html">plot_abundance</a></span>(<span class="st">"Achillea.millefolium"</span>, <span class="st">"veg_coef"</span>)</a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/plots.html">plot_abundance</a></span>(<span class="st">"Achillea.millefolium"</span>, <span class="st">"soil_coef"</span>, <span class="dt">paspen=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/plots.html">plot_abundance</a></span>(<span class="st">"Achillea.millefolium"</span>, <span class="st">"veg_lin"</span>)</a>
<a class="sourceLine" id="cb32-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/pkg/cure4insect/man/plots.html">plot_abundance</a></span>(<span class="st">"Achillea.millefolium"</span>, <span class="st">"soil_lin"</span>)</a></code></pre></div>
</div>
</div>
<div id="web-api" class="section level2">
<h2 class="hasAnchor">
<a href="#web-api" class="anchor"></a>Web API</h2>
<p>The web app sits <a href="http://sc-dev.abmi.ca/ocpu/apps/ABbiodiversity/cure4insect/www/">here</a>. To get more control over the results, use the <a href="https://www.opencpu.org/api.html#api-formats">API</a>.</p>
<p>Make a request using the <code>custom_report</code> function:</p>
<pre class="shell"><code>curl http://sc-dev.abmi.ca/ocpu/apps/ABbiodiversity/cure4insect/R/custom_report/csv \
-H "Content-Type: application/json" -d \
'{"id":["182_362", "182_363"], "species":["AlderFlycatcher", "Achillea.millefolium"]}'</code></pre>
<p>Access spatially explicit and land cover specific prediction for a species using the <code>custom_predict</code> function:</p>
<pre class="shell"><code>curl http://sc-dev.abmi.ca/ocpu/apps/ABbiodiversity/cure4insect/R/custom_predict/json \
-H "Content-Type: application/json" -d \
'{"species":"AlderFlycatcher", "xy":[[-114.4493,58.4651]], "veg":"Mixedwood80"}'</code></pre>
</div>
<div id="explore-single-and-multi-species-results" class="section level2">
<h2 class="hasAnchor">
<a href="#explore-single-and-multi-species-results" class="anchor"></a>Explore single and multi-species results</h2>
<p>To get similar output to <a href="https://abbiodiversity.github.io/cure4insect/site/">this</a>, run script from this file:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/file.show.html">file.show</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"doc/custom-report.R"</span>, <span class="dt">package=</span><span class="st">"cure4insect"</span>))</a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/ABbiodiversity/cure4insect">https://​github.com/​ABbiodiversity/​cure4insect</a>
</li>
<li>Report a bug at <br><a href="https://github.com/ABbiodiversity/cure4insect/issues">https://​github.com/​ABbiodiversity/​cure4insect/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="community">
<h2>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Peter Solymos <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Peter Solymos.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
