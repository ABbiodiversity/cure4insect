<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Core Functions for Custom Reporting — custom_report • cure4insect</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Core Functions for Custom Reporting — custom_report" />
<meta property="og:description" content="These functions load pre-processed data and
calculate intactness and sector effects
for custom regions and sets of species." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cure4insect</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2-1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/example.html">Example Species Report</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ABbiodiversity/cure4insect/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Core Functions for Custom Reporting</h1>
    
    <div class="hidden name"><code>core_functions.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>These functions load pre-processed data and
calculate intactness and sector effects
for custom regions and sets of species.</p>
    </div>

    <pre class="usage"><span class='fu'>load_common_data</span>(<span class='kw'>path</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>version</span><span class='kw'>=</span><span class='kw'>NULL</span>)
<span class='fu'>is_loaded</span>()
<span class='fu'>clear_common_data</span>()
<span class='fu'>subset_common_data</span>(<span class='kw'>id</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>species</span><span class='kw'>=</span><span class='st'>"all"</span>)
<span class='fu'>clear_subset_data</span>()

<span class='fu'>load_species_data</span>(<span class='no'>species</span>, <span class='kw'>boot</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>path</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>version</span><span class='kw'>=</span><span class='kw'>NULL</span>)
<span class='fu'>calculate_results</span>(<span class='no'>y</span>, <span class='kw'>level</span><span class='kw'>=</span><span class='fl'>0.9</span>)
<span class='fu'>rasterize_results</span>(<span class='no'>y</span>)

<span class='fu'>report_all</span>(<span class='kw'>boot</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>path</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>version</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>level</span><span class='kw'>=</span><span class='fl'>0.9</span>, <span class='kw'>cores</span><span class='kw'>=</span><span class='kw'>NULL</span>)
<span class='fu'>flatten</span>(<span class='no'>x</span>, <span class='no'>...</span>)
<span class='co'># S3 method for c4iraw</span>
<span class='fu'>flatten</span>(<span class='no'>x</span>, <span class='kw'>raw_boot</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>limit</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='fu'>custom_report</span>(<span class='kw'>id</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>species</span><span class='kw'>=</span><span class='st'>"all"</span>,
    <span class='kw'>path</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>version</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>address</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>boot</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>level</span><span class='kw'>=</span><span class='fl'>0.9</span>, <span class='kw'>cores</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>raw_boot</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>limit</span><span class='kw'>=</span><span class='kw'>NULL</span>)
<span class='fu'>custom_predict</span>(<span class='no'>species</span>, <span class='no'>xy</span>, <span class='no'>veg</span>, <span class='no'>soil</span>,
    <span class='kw'>path</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>version</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='fu'>set_options</span>(<span class='no'>...</span>)
<span class='fu'>overlay_polygon</span>(<span class='no'>ply</span>)
<span class='fu'>get_all_id</span>(<span class='kw'>mregion</span><span class='kw'>=</span><span class='st'>"both"</span>, <span class='kw'>nr</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>nsr</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>luf</span><span class='kw'>=</span><span class='kw'>NULL</span>)
<span class='fu'>get_all_species</span>(<span class='kw'>taxon</span> <span class='kw'>=</span> <span class='st'>"all"</span>, <span class='kw'>mregion</span><span class='kw'>=</span><span class='st'>"both"</span>, <span class='no'>habitat</span>, <span class='no'>status</span>)
<span class='fu'>get_id_locations</span>()
<span class='fu'>get_id_table</span>(<span class='kw'>mregion</span><span class='kw'>=</span><span class='st'>"both"</span>, <span class='kw'>nr</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>nsr</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>luf</span><span class='kw'>=</span><span class='kw'>NULL</span>)
<span class='fu'>get_species_table</span>(<span class='kw'>taxon</span> <span class='kw'>=</span> <span class='st'>"all"</span>, <span class='kw'>mregion</span><span class='kw'>=</span><span class='st'>"both"</span>, <span class='no'>habitat</span>, <span class='no'>status</span>)
<span class='fu'>get_version_info</span>()
<span class='fu'>get_all_qsid</span>()
<span class='fu'>qs2km</span>(<span class='no'>qsid</span>)
<span class='fu'>make_subset_map</span>()
<span class='fu'>get_subset_info</span>()
<span class='fu'>get_subset_id</span>()
<span class='fu'>get_subset_species</span>()

<span class='fu'>dowload_data</span>(<span class='no'>dir</span>, <span class='kw'>species</span><span class='kw'>=</span><span class='st'>"all"</span>, <span class='kw'>version</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='fu'>load_spclim_data</span>(<span class='no'>species</span>, <span class='kw'>path</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>version</span><span class='kw'>=</span><span class='kw'>NULL</span>)
<span class='fu'>get_levels</span>()
<span class='co'># S3 method for c4ispclim</span>
<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>object</span>, <span class='no'>xy</span>, <span class='no'>veg</span>, <span class='no'>soil</span>,
    <span class='kw'>method</span><span class='kw'>=</span><span class='st'>"simple"</span>, <span class='no'>...</span>)
<span class='fu'>predict_mat</span>(<span class='no'>object</span>, <span class='no'>...</span>)
<span class='co'># S3 method for c4ispclim</span>
<span class='fu'>predict_mat</span>(<span class='no'>object</span>, <span class='no'>xy</span>, <span class='no'>veg</span>, <span class='no'>soil</span>,
    <span class='kw'>method</span><span class='kw'>=</span><span class='st'>"simple"</span>,  <span class='no'>...</span>)
<span class='fu'>combine_veg_soil</span>(<span class='no'>xy</span>, <span class='no'>veg</span>, <span class='no'>soil</span>, <span class='kw'>method</span><span class='kw'>=</span><span class='st'>"simple"</span>)
<span class='fu'>make_multispecies_map</span>(<span class='kw'>type</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"richness"</span>, <span class='st'>"intactness"</span>),
    <span class='kw'>path</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>version</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>clip</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>limit</span><span class='kw'>=</span><span class='kw'>NULL</span>,
    <span class='kw'>area</span><span class='kw'>=</span><span class='st'>"ha"</span>, <span class='kw'>pair_adj</span><span class='kw'>=</span><span class='fl'>2</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>path</th>
      <td><p>path to a local copy of results or <code>NULL</code> (default, the
value of <code>getOption("cure4insect")$baseurl</code>).</p></td>
    </tr>
    <tr>
      <th>version</th>
      <td><p>version of the results or <code>NULL</code> <code>NULL</code> (default, the
value of <code>getOption("cure4insect")$version</code>).</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>character, IDs of the 1km x 1km spatial pixel units to be used for the custom summaries.
The Row_Col field defines the IDs and links the raster cells in the geodatabase
(<a href='http://sc-dev.abmi.ca/reports/2017/grids/Grid1km_working.gdb.zip'>http://sc-dev.abmi.ca/reports/2017/grids/Grid1km_working.gdb.zip</a>)
or CSV
(<a href='http://sc-dev.abmi.ca/reports/2017/grids/Grid1km_working.csv.zip'>http://sc-dev.abmi.ca/reports/2017/grids/Grid1km_working.csv.zip</a>;
with latitude/longitude in NAD_1983_10TM_AEP_Forest projection
<a href='http://spatialreference.org/ref/epsg/3402/'>http://spatialreference.org/ref/epsg/3402/</a>).
If <code>id</code> is a matrix-like object, values of the 1st column are taken.
<code>id</code> can be of class 'SpatialPolygons' defined by the 'sp' package.
The supplied values are turned into character internally.
Use <code>get_all_id</code> to see all possible values.</p></td>
    </tr>
    <tr>
      <th>qsid</th>
      <td><p>character, quarter section (QS) IDs in the
<code>"MER-RGE-TWP-SEC-QS"</code> format, e.g. <code>"4-12-1-2-SE"</code>.
The CSV file <a href='http://sc-dev.abmi.ca/reports/2017/grids/Grid1km_working.csv.zip'>http://sc-dev.abmi.ca/reports/2017/grids/Grid1km_working.csv.zip</a>
has the corresponding coordinates in NAD_1983_10TM_AEP_Forest projection
<a href='http://spatialreference.org/ref/epsg/3402/'>http://spatialreference.org/ref/epsg/3402/</a>).</p></td>
    </tr>
    <tr>
      <th>species</th>
      <td><p>A list of species defined by the field SpeciesID in the table
<a href='http://sc-dev.abmi.ca/reports/2017/data/species-info.csv'>http://sc-dev.abmi.ca/reports/2017/data/species-info.csv</a>.
If <code>species</code> is a matrix-like object, values of the 1st column are taken.
The following values are also accepted to define groups of species:
<code>"all"</code> (all groups/species),
or one of the taxonomic (<code>"birds"</code>, <code>"lichens"</code>, <code>"mammals"</code>,
<code>"mites"</code>, <code>"mosses"</code>, <code>"vplants"</code>) or other
(<code>"upland"</code>, <code>"lowland"</code>, <code>"native"</code>, <code>"nonnative"</code>) groups.
For a combination of filters, see <code>get_all_species</code>.</p></td>
    </tr>
    <tr>
      <th>boot</th>
      <td><p>logical or <code>NULL</code>, if confidence intervals for abundance and intactness are desired.
Defaults to <code>getOption("cure4insect")$boot</code> when <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>level</th>
      <td><p>numeric, level for confidence interval, defaults to 90%.</p></td>
    </tr>
    <tr>
      <th>cores</th>
      <td><p>integer, number of cores used in forking (used on Unix/Linux OS)
or number of cluster workers (on Windows).
Defaults to <code>getOption("cure4insect")$cores</code> when <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>and input object from call to <code>load_species_data</code>.</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>and input object from call to <code>calculate_results</code>.</p></td>
    </tr>
    <tr>
      <th>raw_boot</th>
      <td><p>logical, if raw bootstrap abundance results should be returned.</p></td>
    </tr>
    <tr>
      <th>limit</th>
      <td><p>numeric (0-1), species with mean abundance less than 100 * <code>limit</code>
percent of the maximum abundance (current and reference combined)
are flagged and should not be used when calculating multi-species metrics
because the species is not effectively present in the region.
Defaults to <code>getOption("cure4insect")$limit</code> when <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>address</th>
      <td><p>character, optional email address to send finished results to
in the format <code>"name@domain.org"</code>.
The default (<code>NULL</code>) is not to send an email.</p></td>
    </tr>
    <tr>
      <th>object</th>
      <td><p>and input object from call to <code>load_spclim_data</code>.</p></td>
    </tr>
    <tr>
      <th>xy</th>
      <td><p>a 'SpatialPoints' object defined by the 'sp' package
with geographic coordinates corresponding to <code>veg</code> and <code>soil</code>
(i.e. centroids of polygons).</p></td>
    </tr>
    <tr>
      <th>veg, soil</th>
      <td><p>factor, vegetation/soil classes. One of the two or both must be provided.
Can be <code>NULL</code> or missing.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>character, the method argument for raster value <code><a href='https://rdrr.io/pkg/raster/man/extract.html'>extract</a></code>ion.
<code>"simple"</code>: values for the cell a point falls in,
<code>"bilinear"</code>: interpolated from the values of the four nearest raster cells.</p></td>
    </tr>
    <tr>
      <th>taxon</th>
      <td><p>character, return <code>"all"</code> species, or a subset
(one or more of <code>"birds"</code>, <code>"lichens"</code>, <code>"mammals"</code>,
<code>"mites"</code>, <code>"mosses"</code>, <code>"vplants"</code>).</p></td>
    </tr>
    <tr>
      <th>habitat</th>
      <td><p>character, one of <code>"upland"</code> or <code>"lowland"</code> to indicate
expert based habitat associations in Alberta.</p></td>
    </tr>
    <tr>
      <th>status</th>
      <td><p>character, one of <code>"native"</code> or <code>"nonnative"</code> to indicate
expert based status in Alberta.</p></td>
    </tr>
    <tr>
      <th>mregion</th>
      <td><p>character, modeling region (<code>"both"</code>, <code>"north"</code>, or <code>"south"</code>).</p></td>
    </tr>
    <tr>
      <th>nr, nsr, luf</th>
      <td><p>character vector, narural regions (nr), natural subregions (nsr), and
land use framework regions (luf) of Alberta.</p></td>
    </tr>
    <tr>
      <th>ply</th>
      <td><p>an object of class 'SpatialPolygons' defined by the 'sp' package.</p></td>
    </tr>
    <tr>
      <th>clip</th>
      <td><p>logical, if the multi-species map needs to be clipped to the region bounds
defined by the spatial subset.</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>character, the type of multi-species map to produce.
<code>"intactness"</code> is the raster cell level average intactness across species,
<code>"richness"</code> is probability of &gt;0 observation in a 1 ha plot
summed across species (expected species richness).</p></td>
    </tr>
    <tr>
      <th>area, pair_adj</th>
      <td><p>spatial scale (<code>"ha"</code> or <code>"km"</code>) and pair adjustment factor
to turn bird densities into probability of observing non-zero count
before calculating richness (sum of these probabilities).</p></td>
    </tr>
    <tr>
      <th>dir</th>
      <td><p>Character, a directory name to download the data to.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Arguments in <code>tag = value</code> form, or a list of tagged values.
The tags are configuration settings as described below.
For the <code>dowload_data</code> function, these arguments are
passed to <code><a href='https://rdrr.io/r/utils/download.file.html'>download.file</a></code></p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Configuration is stored in the file
<code><a href='https://rdrr.io/r/base/system.file.html'>system.file("config/defaults.conf", package="cure4insect")</a></code>.
Current options are:
<code>path</code> (path to results),
<code>version</code> (version of results),
<code>verbose</code> (default is 1, value 0 suppresses the messages),
<code>cores</code> (number of cores to use in parallel calculations,
uses forking on Linux/Unix/Mac and socket clusters on Windows, default is 1),
<code>limit</code> (abundance threshold for regional intactness calculations),
<code>boot</code> (bootstrap based uncertainties used or not),
<code>trunc</code> (quantile for truncating rasterized maps to avoid outliers),
<code>sender</code> (email of sender),
<code>subject</code> (subject of the email),
and <code>body</code> (body of the email).</p>
<p>The multicore processing performance (not on Windows, where shared memory forked
processes are not available) might be limited by memory and
network speed/bandwidth. Local copy of the data is the
surest way to boost performance.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>load_common_data</code> loads common data to memory of the R session.
<code>is_loaded</code> check if common data has been loaded previously.</p>
<p><code>subset_common_data</code> subsets the common data and makes the information
available in the R session.
<code>make_subset_map</code> makes a raster map of the spatial selection,
<code>get_subset_info</code> counts the number of species and 1 square km
spatial pixel units in the selection. <code>get_subset_id</code> and
<code>get_subset_species</code> returns the species and spatial IDs,
respectively, based on the selection.</p>
<p><code>load_species_data</code> load data of a single species
and returns it.</p>
<p><code>clear_common_data</code>, and <code>clear_subset_data</code>
clears the respective environments.</p>
<p><code>calculate_results</code> calculates intactness and sector effects
results based on spatial subset definitions and
single species data. The output is a list of class 'c4iraw'.
The <code>flatten</code> method arranges the results from <code>calculate_results</code>
into a 1-liner data frame.</p>
<p><code>report_all</code> calculate results based on sequential calls
to <code>load_species_data</code> for all species defined in the subset.
Returns a list (class 'c4ilist') output from <code>calculate_results</code>.</p>
<p><code>custom_report</code> wrapper function to load common data,
subset spatial units and species list, calculate results for all species,
and optionally send results as attachment of a email.
Returns an object of class 'c4idf' (inheriting from data frame),
rows representing species (flattened results, the Comment field
flagging possible issues).</p>
<p><code>overlay_polygon</code> selects spatial IDs based on a 'SpatialPolygons' object.</p>
<p><code>rasterize_results</code> takes the single species data
without any spatial subset. The output is a raster <code><a href='https://rdrr.io/pkg/raster/man/stack.html'>stack</a></code>
object with the following layers:
NC (current abundance),
NR (reference abundance),
SI (intactness),
SI2 (two-sided intactness),
SE, and CV (bootstrap based standard error and coefficient of variation
estimates for current abundance).</p>
<p><code>make_multispecies_map</code> calculated multi-species maps of richness
(1-ha based probability of occurrence summed across species)
or intactness (mean pixel level intactness of species whose
mean abundance in the subset region is at least 100 * <code>limit</code>
percent of the provincial maximum abundance).</p>
<p><code>set_options</code> sets the options and return previous values invisibly.
<code>dowload_data</code> downloads the data to the hard drive so that it can
be used later. Set the path in the file
<code><a href='https://rdrr.io/r/base/system.file.html'>system.file("config/defaults.conf", package="cure4insect")</a></code>
to have permanent effect, or in each session using <code>set_options</code>.</p>
<p><code>get_all_id</code> gets all possible spatial IDs.
<code>get_all_species</code> gets <code>"all"</code> possible species IDs,
or a subset of those IDs for a selected <code>taxon</code>.
<code>get_id_locations</code> gets the 'SpatialPoints' object
with geographic coordinates of the spatial IDs, <code>get_species_table</code>
gets the lookup table for species, or a group of species as defined by the
<code>taxon</code> argument.
<code>get_all_qsid</code> gets all possible quarter section (QS) IDs,
<code>qs2km</code> finds the 1 square km units corresponding to the
quarter section IDs. QS IDs are composed as <code>"MER-RGE-TWP-SEC-QS"</code>
(Meridian [4-6], Range[1-30], Township[1-127], Section[1-36],
and Quarter Section [NE, NW, SE, SW]), e.g. <code>"4-12-1-2-SE"</code>.
All these require to run <code>load_common_data()</code> first.</p>
<p><code>load_spclim_data</code> is used to load raster data for spatially
explicit predictions by <code>predict.c4ispclim</code>.
<code>predict.c4ispclim</code> returns a data frame with columns
'veg', 'soil', and 'comb' (combines 'veg' and 'soil' using
<code>combine_veg_soil</code> as a weighted average).
Note: for some species, either the 'veg' or 'soil' based estimates are
unavailable. <code>predict.c4ispclim</code> returns <code>NA</code> for these
and the combined results will be <code>NA</code> as well.</p>
<p><code>get_version_info</code> returns detailed version info for each taxa,
depending on the <code>version</code> set through options or
<code>load_common_data</code>, including the following variables:
<code>taxon</code>,
<code>version</code> (year of production),
1st and last year of field sampling (<code>yr_first</code>, <code>yr_last</code>),
field <code>method</code>ology,
base year and version of human footprint inventory (<code>hf</code>),
version of the backfilled vegetation layer (<code>veg</code>),
the type of model used (<code>model</code>),  and the number of
<code>species</code> by taxon. <code>load_common_data</code> prints
these info upon successfully loading common data objects.</p>
<p><code>get_levels</code> returns a list
with elements 'veg' for vegetation and 'soil' for soil class levels
expected by <code>predict.c4ispclim</code>. The <code>predict_clim</code>
method is similar, but expects <code>veg</code> and <code>soil</code>
to be a composition matrix with rows corresponding to
points in space (e.g. grid cell centroids) and columns
to correspond to vegetation/soil classes, with cell values
as areas or proportions (row standardized). The return value
is a list with elements <code>veg</code> and <code>soil</code>,
each containing either a matrix with same dimensions
as the corresponding input, or <code>NULL</code> when the input is missing.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code>plot_sector</code> and <code>plot_abundance</code> for plots.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'>## workflow with 1 species --------------------</span>
<span class='co'>## ID is a vector of Row_Col IDs of 1km pixels</span>
<span class='co'>## species is a vector if species IDs</span>
<span class='fu'>load_common_data</span>()
<span class='fu'>is_loaded</span>()
<span class='fu'>get_version_info</span>() <span class='co'># important details about versions</span>
<span class='co'>## here is how to inspect all possible spatial and species IDs</span>
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='fu'>get_all_id</span>())
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='fu'>get_all_species</span>())
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>xy</span> <span class='kw'>&lt;-</span> <span class='fu'>get_id_locations</span>(), <span class='kw'>pch</span><span class='kw'>=</span><span class='st'>"."</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>xy</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='fu'>get_species_table</span>())
<span class='co'>## define spatial and species IDs</span>
<span class='no'>Spp</span> <span class='kw'>&lt;-</span> <span class='st'>"Ovenbird"</span>
<span class='no'>ID</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"182_362"</span>, <span class='st'>"182_363"</span>, <span class='st'>"182_364"</span>, <span class='st'>"182_365"</span>, <span class='st'>"182_366"</span>, <span class='st'>"182_367"</span>,
    <span class='st'>"182_368"</span>, <span class='st'>"182_369"</span>, <span class='st'>"182_370"</span>, <span class='st'>"182_371"</span>, <span class='st'>"182_372"</span>)
<span class='fu'>subset_common_data</span>(<span class='kw'>id</span><span class='kw'>=</span><span class='no'>ID</span>, <span class='kw'>species</span><span class='kw'>=</span><span class='no'>Spp</span>)
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fu'>load_species_data</span>(<span class='st'>"Ovenbird"</span>)
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>calculate_results</span>(<span class='no'>y</span>)
<span class='no'>x</span>
<span class='fu'>flatten</span>(<span class='no'>x</span>)

<span class='co'>## using quarter sections</span>
<span class='no'>Spp</span> <span class='kw'>&lt;-</span> <span class='st'>"Ovenbird"</span>
<span class='no'>QSID</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"4-12-1-2-SE"</span>, <span class='st'>"4-12-1-2-SW"</span>, <span class='st'>"4-12-1-3-SE"</span>, <span class='st'>"4-12-1-3-SW"</span>)
<span class='fu'>qs2km</span>(<span class='no'>QSID</span>) <span class='co'># corresponding Row_Col IDs</span>
<span class='fu'>subset_common_data</span>(<span class='kw'>id</span><span class='kw'>=</span><span class='no'>QSID</span>, <span class='kw'>species</span><span class='kw'>=</span><span class='no'>Spp</span>)
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fu'>load_species_data</span>(<span class='no'>Spp</span>)
<span class='fu'>flatten</span>(<span class='fu'>calculate_results</span>(<span class='no'>y</span>))

<span class='co'>## using pre-defined planning/management regions</span>
<span class='co'>#ID &lt;- get_all_id(nr=c("Boreal", "Foothills"))</span>
<span class='no'>ID</span> <span class='kw'>&lt;-</span> <span class='fu'>get_all_id</span>(<span class='kw'>luf</span><span class='kw'>=</span><span class='st'>"North Saskatchewan"</span>)
<span class='fu'>subset_common_data</span>(<span class='kw'>id</span><span class='kw'>=</span><span class='no'>ID</span>)
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='fu'>make_subset_map</span>())

<span class='co'>## workflow with multiple species ----------------</span>
<span class='fu'>load_common_data</span>() <span class='co'># use as before</span>
<span class='co'>## id and species can be defined using text files</span>
<span class='no'>Spp</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.table</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span>(<span class='st'>"extdata/species.txt"</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>"cure4insect"</span>))
<span class='no'>ID</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.table</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span>(<span class='st'>"extdata/pixels.txt"</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>"cure4insect"</span>))
<span class='fu'>subset_common_data</span>(<span class='kw'>id</span><span class='kw'>=</span><span class='no'>ID</span>, <span class='kw'>species</span><span class='kw'>=</span><span class='no'>Spp</span>)
<span class='no'>xx</span> <span class='kw'>&lt;-</span> <span class='fu'>report_all</span>()
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>xx</span>)
<span class='fu'><a href='https://rdrr.io/r/base/do.call.html'>do.call</a></span>(<span class='no'>rbind</span>, <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>xx</span>, <span class='no'>flatten</span>))

<span class='co'>## ID can also be a SpatialPolygons object based on GeoJSON for example</span>
<span class='co'>#library(rgdal)</span>
<span class='co'>#dsn &lt;- system.file("extdata/polygon.geojson", package="cure4insect")</span>
<span class='co'>#ply &lt;- readOGR(dsn=dsn)</span>
<span class='co'>#subset_common_data(id=ply, species=Spp)</span>
<span class='co'>#xx2 &lt;- report_all()</span>

<span class='co'>## wrapper function ----------------------</span>
<span class='co'>## species="all" runs all species</span>
<span class='co'>## species="mites" runs all mite species</span>
<span class='co'>## sender="you@example.org" will send an email with the results attached</span>
<span class='co'>## increase cores to allow parallel processing</span>
<span class='no'>z</span> <span class='kw'>&lt;-</span> <span class='fu'>custom_report</span>(<span class='kw'>id</span><span class='kw'>=</span><span class='no'>ID</span>,
    <span class='kw'>species</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"AlderFlycatcher"</span>, <span class='st'>"Achillea.millefolium"</span>),
    <span class='kw'>address</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>cores</span><span class='kw'>=</span><span class='fl'>1</span>)
<span class='no'>z</span>

<span class='co'>## making of the file raw_all.rda</span>
<span class='no'>opar</span> <span class='kw'>&lt;-</span> <span class='fu'>set_options</span>(<span class='kw'>path</span> <span class='kw'>=</span> <span class='st'>"w:/reports"</span>)
<span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span>(<span class='st'>"cure4insect"</span>)
<span class='fu'>load_common_data</span>()
<span class='no'>SPP</span> <span class='kw'>&lt;-</span> <span class='fu'>get_all_species</span>()
<span class='fu'>subset_common_data</span>(<span class='kw'>id</span><span class='kw'>=</span><span class='fu'>get_all_id</span>(), <span class='kw'>species</span><span class='kw'>=</span><span class='no'>SPP</span>)
<span class='no'>res</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>()
<span class='kw'>for</span> (<span class='no'>i</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>SPP</span>)) {
    <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span>(<span class='st'>"processing species:"</span>, <span class='no'>SPP</span>[<span class='no'>i</span>], <span class='no'>i</span>, <span class='st'>"/"</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>SPP</span>), <span class='st'>"\n"</span>)
    <span class='fu'><a href='https://rdrr.io/r/utils/flush.console.html'>flush.console</a></span>()
    <span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fu'>load_species_data</span>(<span class='no'>SPP</span>[<span class='no'>i</span>])
    <span class='no'>res</span><span class='kw'>[[</span><span class='no'>i</span>]] <span class='kw'>&lt;-</span> <span class='fu'>calculate_results</span>(<span class='no'>y</span>)
}
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>res</span>) <span class='kw'>&lt;-</span> <span class='no'>SPP</span>

<span class='co'>## spatial maps</span>
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fu'>load_species_data</span>(<span class='st'>"Ovenbird"</span>)
<span class='no'>r</span> <span class='kw'>&lt;-</span> <span class='fu'>rasterize_results</span>(<span class='no'>y</span>)
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>r</span>, <span class='st'>"NC"</span>) <span class='co'># current abundance map</span>
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>r</span>, <span class='st'>"SE"</span>) <span class='co'># standadr errors for current abundance</span>

<span class='co'>## making multi-species richness and intactness maps for birds</span>
<span class='fu'>subset_common_data</span>(<span class='kw'>species</span><span class='kw'>=</span><span class='fu'>get_all_species</span>(<span class='kw'>taxon</span><span class='kw'>=</span><span class='st'>"birds"</span>))
<span class='no'>r1</span> <span class='kw'>&lt;-</span> <span class='fu'>make_multispecies_map</span>(<span class='st'>"richness"</span>)
<span class='no'>r2</span> <span class='kw'>&lt;-</span> <span class='fu'>make_multispecies_map</span>(<span class='st'>"intactness"</span>)
}

<span class='co'>## working with a local copy of the results is much faster</span>
<span class='co'>## set path via function arguments or the options:</span>
<span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span>(<span class='st'>"cure4insect"</span>)</div><div class='output co'>#&gt; $path
#&gt; [1] "http://sc-dev.abmi.ca/reports"
#&gt; 
#&gt; $version
#&gt; [1] "2018"
#&gt; 
#&gt; $verbose
#&gt; [1] "1"
#&gt; 
#&gt; $cores
#&gt; [1] "2"
#&gt; 
#&gt; $limit
#&gt; [1] "0.01"
#&gt; 
#&gt; $boot
#&gt; [1] "TRUE"
#&gt; 
#&gt; $trunc
#&gt; [1] "0.99"
#&gt; 
#&gt; $sender
#&gt; [1] "noreply@science.abmi.ca"
#&gt; 
#&gt; $subject
#&gt; [1] "Custom Report for Intactness and Sector Effects"
#&gt; 
#&gt; $body
#&gt; [1] "Hi,\\n\\nYour custom report results are attached.\\n\\nWith regards,\\n\\nthe ABMI Science Team"
#&gt; </div><div class='input'>(<span class='no'>opar</span> <span class='kw'>&lt;-</span> <span class='fu'>set_options</span>())</div><div class='output co'>#&gt; $path
#&gt; [1] "http://sc-dev.abmi.ca/reports"
#&gt; 
#&gt; $version
#&gt; [1] "2018"
#&gt; 
#&gt; $verbose
#&gt; [1] "1"
#&gt; 
#&gt; $cores
#&gt; [1] "2"
#&gt; 
#&gt; $limit
#&gt; [1] "0.01"
#&gt; 
#&gt; $boot
#&gt; [1] "TRUE"
#&gt; 
#&gt; $trunc
#&gt; [1] "0.99"
#&gt; 
#&gt; $sender
#&gt; [1] "noreply@science.abmi.ca"
#&gt; 
#&gt; $subject
#&gt; [1] "Custom Report for Intactness and Sector Effects"
#&gt; 
#&gt; $body
#&gt; [1] "Hi,\\n\\nYour custom report results are attached.\\n\\nWith regards,\\n\\nthe ABMI Science Team"
#&gt; </div><div class='input'><span class='fu'>set_options</span>(<span class='kw'>path</span> <span class='kw'>=</span> <span class='st'>"/your/path/to/local/copy"</span>)
(<span class='fu'>set_options</span>(<span class='no'>opar</span>)) <span class='co'># reset options</span></div><div class='output co'>#&gt; $path
#&gt; [1] "/your/path/to/local/copy"
#&gt; 
#&gt; $version
#&gt; [1] "2018"
#&gt; 
#&gt; $verbose
#&gt; [1] "1"
#&gt; 
#&gt; $cores
#&gt; [1] "2"
#&gt; 
#&gt; $limit
#&gt; [1] "0.01"
#&gt; 
#&gt; $boot
#&gt; [1] "TRUE"
#&gt; 
#&gt; $trunc
#&gt; [1] "0.99"
#&gt; 
#&gt; $sender
#&gt; [1] "noreply@science.abmi.ca"
#&gt; 
#&gt; $subject
#&gt; [1] "Custom Report for Intactness and Sector Effects"
#&gt; 
#&gt; $body
#&gt; [1] "Hi,\\n\\nYour custom report results are attached.\\n\\nWith regards,\\n\\nthe ABMI Science Team"
#&gt; </div><div class='input'>
<span class='co'>## change configs in this file to make it permanent for a given installation</span>
<span class='fu'><a href='https://rdrr.io/r/base/list.html'>as.list</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/drop.html'>drop</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/dcf.html'>read.dcf</a></span>(<span class='kw'>file</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span>(<span class='st'>"config/defaults.conf"</span>,
<span class='kw'>package</span><span class='kw'>=</span><span class='st'>"cure4insect"</span>))))</div><div class='output co'>#&gt; $path
#&gt; [1] "http://sc-dev.abmi.ca/reports"
#&gt; 
#&gt; $version
#&gt; [1] "2018"
#&gt; 
#&gt; $verbose
#&gt; [1] "1"
#&gt; 
#&gt; $cores
#&gt; [1] "2"
#&gt; 
#&gt; $limit
#&gt; [1] "0.01"
#&gt; 
#&gt; $boot
#&gt; [1] "TRUE"
#&gt; 
#&gt; $trunc
#&gt; [1] "0.99"
#&gt; 
#&gt; $sender
#&gt; [1] "noreply@science.abmi.ca"
#&gt; 
#&gt; $subject
#&gt; [1] "Custom Report for Intactness and Sector Effects"
#&gt; 
#&gt; $body
#&gt; [1] "Hi,\\n\\nYour custom report results are attached.\\n\\nWith regards,\\n\\nthe ABMI Science Team"
#&gt; </div><div class='input'>
<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'>## spatially explicit prediction</span>
<span class='fu'>load_common_data</span>()
<span class='co'>## see bird species codes</span>
<span class='no'>sptab</span> <span class='kw'>&lt;-</span> <span class='fu'>get_species_table</span>()
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>sptab</span>)[<span class='no'>sptab</span>$<span class='no'>taxon</span> <span class='kw'>==</span> <span class='st'>"birds"</span>]
<span class='co'>## pick Ovenbird</span>
<span class='no'>species</span> <span class='kw'>&lt;-</span> <span class='st'>"Ovenbird"</span>
<span class='no'>object</span> <span class='kw'>&lt;-</span> <span class='fu'>load_spclim_data</span>(<span class='no'>species</span>)
<span class='co'>## vegetation/disturbance classes: use as factor</span>
<span class='co'>## might need to make a crosswalk, use e.g. mefa4::reclass</span>
(<span class='no'>veg</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span>(<span class='fu'>get_levels</span>()$<span class='no'>veg</span>))
<span class='co'>## for each veg class value, need to have</span>
<span class='co'>## spatial locations (can repeat the same value,</span>
<span class='co'>## but avoid duplicate rownames)</span>
<span class='co'>## use the sp package to get SpatialPoints as here:</span>
<span class='no'>XY</span> <span class='kw'>&lt;-</span> <span class='fu'>get_id_locations</span>()
<span class='no'>coords</span> <span class='kw'>&lt;-</span> <span class='fu'>coordinates</span>(<span class='no'>XY</span>)[<span class='fl'>10</span>^<span class='fl'>5</span>,,<span class='kw'>drop</span><span class='kw'>=</span><span class='fl'>FALSE</span>]
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>coords</span>) <span class='kw'>&lt;-</span> <span class='kw'>NULL</span>
<span class='no'>xy</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='no'>coords</span>[<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>veg</span>)),])
<span class='fu'>coordinates</span>(<span class='no'>xy</span>) <span class='kw'>&lt;-</span> ~ <span class='no'>POINT_X</span> + <span class='no'>POINT_Y</span>
<span class='fu'>proj4string</span>(<span class='no'>xy</span>) <span class='kw'>&lt;-</span> <span class='fu'>proj4string</span>(<span class='no'>XY</span>)
<span class='co'>## predict</span>
<span class='no'>pred</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>object</span>, <span class='kw'>xy</span><span class='kw'>=</span><span class='no'>xy</span>, <span class='kw'>veg</span><span class='kw'>=</span><span class='no'>veg</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>pred</span>)
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Peter Solymos.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


